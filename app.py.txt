import plotly.express as px


# --- Weekly Analytics ---
st.divider()
st.header("📈 Weekly Volume Analytics")


if os.path.isfile("workout_history.csv"):
    df_analytics = pd.read_csv("workout_history.csv")
    
    # Extract numeric volume (meters for track, kg/lbs for weights)
    df_analytics['Volume'] = df_analytics['Actual'].str.extract(r'(\d+)').astype(float)
    df_analytics['Date'] = pd.to_datetime(df_analytics['Date'])
    df_analytics['Week_Num'] = df_analytics['Date'].dt.isocalendar().week


    # Create two columns for charts
    col_chart1, col_chart2 = st.columns(2)


    with col_chart1:
        st.subheader("🏃‍♂️ Sprint Volume (Meters)")
        track_df = df_analytics[df_analytics['Day'].str.contains("Track")]
        if not track_df.empty:
            sprint_vol = track_df.groupby('Week_Num')['Volume'].sum().reset_index()
            fig_track = px.bar(sprint_vol, x='Week_Num', y='Volume', 
                               labels={'Volume': 'Total Meters', 'Week_Num': 'Week'},
                               color_discrete_sequence=['#FF4B4B'])
            st.plotly_chart(fig_track, use_container_width=True)


    with col_chart2:
        st.subheader("🏋️‍♂️ Lifting Volume (Total Reps)")
        weight_df = df_analytics[df_analytics['Day'].str.contains("Weights")]
        if not weight_df.empty:
            lift_vol = weight_df.groupby('Week_Num')['Volume'].count().reset_index()
            fig_weight = px.line(lift_vol, x='Week_Num', y='Volume', 
                                 labels={'Volume': 'Number of Sets completed'},
                                 markers=True)
            st.plotly_chart(fig_weight, use_container_width=True)
else:
    st.info("Charts will appear here once you save your first few sessions.")